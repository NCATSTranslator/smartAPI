{% extends "main.html" %}
{% block content %}
{% include "header.html" %}
{% raw %}
<div id="dashApp" class=""  style="height: 100%;">
  <div class="row" style="margin-bottom: 0">
      <div class="col s12 m4 l3 xl3 blue gradientBackground">
        <ul class="collection" style="border: none;">
          <li class="collection-item " style="background-color: transparent;">
            <img id="dashboardPhoto" src="" class="responsive-img circle" alt="user image">
          </li>
          <li class="collection-item center-align blue white-text swing-in-top-fwd">
            <h4 class="text_h3 white-text" id="dashboardName">User</h4>
            <p>@<span id="dashboardUsername"></span></p>
          </li>
          <li class="collection-item">
            <p>Contributions<span class="chip secondary-content badge blue white-text">{{total}} APIs</span></p>
          </li>
          <li class="collection-item center-align">
            <a href="" class="btn blue">Button</a>
          </li>
          <li class="collection-item center-align">
            <a href="/logout" class="btn red">Log Out</a>
          </li>
        </ul>
      </div>
    <div class="col s12 m8 l9 xl9 white center-align" >
        <h4 class="text_h3 blue-text tracking-in-expand">My Dashboard</h4>
        <div class="row">
          <div class="col s12">
            <ul class="tabs blue-text">
              <li class="tab col s3">
                <a class="blue-text" href="#contributions">My Contributions ({{total}})</a>
              </li>
              <li class="tab col s3"><a class="blue-text" href="#details">
                Future Features</a>
              </li>
              <li class="tab col s3"><a class="blue-text" href="#about">
                About SmartAPI</a>
              </li>
            </ul>
          </div>
          <div id="contributions" class="col s12 card-panel ">
              <table class="bordered highlight" style="table-layout: fixed;">
                <thead>
                  <tr class="grey-text">
                      <th>API Name</th>
                      <th>Description</th>
                      <th class="center-align">Refresh</th>
                      <th class="center-align">Delete</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- For each API -->
                  <tr v-for="(api,index) in apis" class="">
                    <td>
                       <a href="#modal2" class="modal-trigger" @click="getDetails(api.info)"><b>{{ api.info.title }}</b> <span class="grey-text" style="font-size:12px">V.{{api.info.version}}</span></a>
                    </td>
                    <td class="tableTextOverflow">
                      <p class="tableTextOverflow">{{ api.info.description }}</p>
                    </td>
                    <td class="center-align">
                      <a @click="refreshingThis(api.info.title)" class="btn green white-text">
                        <i class="large material-icons"  @mouseenter="$event.target.classList.add('rotate')" @mouseleave="$event.target.classList.remove('rotate')">autorenew</i>
                      </a>
                    </td>
                    <td class="center-align">
                      <a href="#modal1" @click="deleteAPI(api.info.title, api._id)" class="btn red white-text modal-trigger">
                        <i class="large material-icons">delete_forever</i>
                      </a>
                    </td>
                  </tr>
                  
                </tbody>
              </table>
          </div>
          <div id="details" class="col s12 card-panel ">
              <!-- Selected API details -->
          </div>
          <div id="about" class="col s12 card-panel center-align blue-text">
              <h1 class="text_h2">SmartAPI</h1>
              <p>Version 1.2</p>
              <div class="card-panel">
                <h3 class="text_h3 blue-text">SmartAPI Links:</h3>
                <ul>
                  <li><a href="https://github.com/SmartAPI/smartAPI" class="">SmartAPI Repository</a></li>
                  <li><a href="https://github.com/SmartAPI/smartAPI-Specification" class="">SmartAPI Specification</a></li>
                  <li><a href="smartAPI-editor" class="">SmartAPI Editor</a></li>
                  <li><a href="https://github.com/SmartAPI/smartapi_registry" class="">SmartAPI Registry</a></li>
                </ul>
            </div>
            <div class="card-panel">
              <h3 class="text_h3 blue-text">Contact</h3>
              <a href="mailto:" class="">Email Us</a>
            </div>
          </div>
        </div>
    </div>
  </div>
  <!-- Modal for Deletion Confirmation -->
  <div id="modal1" class="modal center-align">
    <div class="modal-content">
      <h4 class="text_h3 blue-text">Delete <b>{{ confirmModal.title }}</b>?</h4>
      <a href='#!' @click="deleteForever(confirmModal.title, confirmModal.id)" class="red btn modal-action modal-close">Confirm Delete</a>
      <hr>
      <a href="#!" class="btn blue modal-action modal-close">Cancel</a>
    </div>
  </div>
  <!-- delete Modal end -->
  <!-- Details Modal -->
  <div id="modal2" class="modal center-align">
    <div class="modal-content"> 
      <ul class="collection with-header">
        <li class="collection-header"><h4 class="text_h3 blue-text">{{selectedAPI.title}}</h4></li>
        <li class="collection-item">
          {{ selectedAPIContact.name }}<span class="grey-text"> / {{selectedAPIContact["x-role"]}}</span>
        </li>
        <li class="collection-item">
          <p class="blue-text">Description:</p>
          <p>{{ selectedAPI.description }}</p>
        </li>
        <li class="collection-item">Version {{ selectedAPI.version }}</li>
        <li class="collection-item"><a :href="selectedAPI.termsOfService" target="_blank">Terms of Service</a></li>
      </ul>
      <a href="#!" class="btn blue modal-action modal-close">Close</a>
    </div>
  </div>
  <!-- details modal end -->
</div>




{% endraw %}
{% include "footer.html" %}
{% endblock %}

{% block extra_scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.4.2/vue.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.6/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js"></script>

<script>
    var app = new Vue({
        el: '#dashApp',
        data: {
          userInfo:{
            name:'',
            username:'newgene',
            avatar:'',
            email:''
          },
          confirmModal:{
            title:'',
            id:''
          },
          selectedAPI:{},
          selectedAPIContact: {},
          apis:[],
          total: 0
        },
        methods:{
          getApis: function(){
            var self=this;
            axios.get("http://smart-api.info/api/query?size=100&q=_meta.github_username:"+self.userInfo.username).then(function(response){
                  //console.log(response.data.hits);
                  self.apis = response.data.hits;
                  self.total = response.data.total;
              });
          },
          deleteAPI: function(title, id){
            // api information sent to modal for confirmation to be deleted
            var self = this;
            self.confirmModal.title= title;
            self.confirmModal.id = id;
          },
          deleteForever: function(title, id){
            // ID for api to be deleted forever
            //console.log(id+' deleted TEST');
            Materialize.toast(title+' was Deleted!', 4000,'rounded red white-text');
          },
          refreshingThis: function(title){
            Materialize.toast(title+' was Refreshed!', 4000,'rounded green white-text');
            Materialize.toast(title+' Failed To Refresh', 4000,'rounded red white-text');
          },
          getDetails: function(fullApiInfo){
            var self = this;
            self.selectedAPI = fullApiInfo;
            self.selectedAPIContact = self.selectedAPI.contact;
          }
        },
        mounted: function(){
           // JQuery Initializations
           this.getApis();
           // tabs
           $('ul.tabs').tabs();
           // modals
           $('.modal').modal({dismissible: true});
           // notifications
           $('.tooltipped').tooltip({delay: 50});

        }
    });
</script>
{% endblock %}